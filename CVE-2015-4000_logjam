#!/usr/bin/env bash

clear

SERVER=$1
VULNERABLE="FALSE"

echo -e "Site Under Scope: "$SERVER"\n"

# OpenSSL requires the port number.
DELAY=1
echo -e "Obtaining cipher list from $(openssl version)\n"
ciphers=$(openssl ciphers 'ALL:eNULL' | sed -e 's/:/ /g')


for cipher in ${ciphers[@]}
do

	result=$(echo -n | openssl s_client -msg -cipher "$cipher" -connect $SERVER 2>&1)

	if [[ "$result" =~ "Cipher is ${cipher}" || "$result" =~ "Cipher    :" ]] ; then			

		length=$(echo -n $result | grep -o "ServerKeyExchange\s\S\S\s\S\S\s\S\S\s\S\S\s\S\S" 2>&1)	 

		case "$result" in
		*EDH*)
			echo -e "\nTesting $cipher... DIFFIE-HELLMAN CIPHER SUPPORTED"
			echo -e "\n$length"
			[[ "$length" == *00 ]] && echo "SERVERPRIVATEKEY < 2048 bits"
			if [[ "$cipher" =~ ^EXP* ]]; then VULNERABLE="TRUE"; fi
			;;
		*ECDHE*)
			echo -e "\nTesting $cipher... EPHEMERAL ELIPTIC CURVE DIFFIE-HELLMAN CIPHER SUPPORTED"	
			[[ "$length" == *00 ]] && echo "SERVERPRIVATEKEY < 2048 bits"		
			echo "$lenght"
			;;
		*EXP*)
			echo -e "\nTesting $cipher...SUPPORTED - EXPORT CIPHER SUPPORTED"
			;;	
		*)
			;;
		esac
	fi
sleep $DELAY
done
if [[ "$VULNERABLE" == "TRUE" ]] ; then
	echo -e "\n####################################\n      VULNERABLE SITE      \n####################################"
else
	echo -e "\n####################################\n         SECURE SITE         \n####################################"
fi
